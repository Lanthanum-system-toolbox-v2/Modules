!module
class=cpua
!view
view=title
text=Qualcomm Big.Little load balancing
@show
echo true
@show
!view

!view
view=edittext
@current
cat /proc/sys/kernel/sched_upmigrate
@current
text=Small cluster > large cluster required load
@done
until [ `cat /proc/sys/kernel/sched_upmigrate` == $edittext ]
do
echo $edittext > /proc/sys/kernel/sched_upmigrate
done
@done
core=true
@show
if [ -e /proc/sys/kernel/sched_upmigrate ]
then
echo true
fi
@show
root=true
!view

!view
view=edittext
@current
cat /proc/sys/kernel/sched_downmigrate
@current
text=Big cluster>Small cluster load
@done
echo $edittext > /proc/sys/kernel/sched_downmigrate
@done
core=true
@show
if [ -e /proc/sys/kernel/sched_downmigrate ]
then
echo true
fi
@show
root=true
!view

!view
view=subtitle
text=When does the following configuration force the task to be dropped into the small core:
@show
echo true
@show
!view

!view
view=edittext
@current
cat /proc/sys/kernel/sched_spill_nr_run
@current
text=Number of tasks in a certain period of time:
@done
echo $edittext > /proc/sys/kernel/sched_spill_nr_run
@done
core=true
@show
if [ -e /proc/sys/kernel/sched_spill_nr_run ]
then
echo true
fi
@show
root=true
!view

!view
view=edittext
@current
cat /proc/sys/kernel/sched_spill_load
@current
text=Load:
@done
echo $edittext > /proc/sys/kernel/sched_spill_load
@done
core=true
@show
if [ -e /proc/sys/kernel/sched_spill_load ]
then
echo true
fi
@show
root=true
!view

!view
view=spinner
text=Preset configuration:
item=Touch write to a preset mode | Large core priority load mode | Small core active mode
@show
echo true
@show
root=true
@done
if [ $position == 1 ]
then
until [ `cat /proc/sys/kernel/sched_upmigrate` == 0 ]
do
echo 0 > /proc/sys/kernel/sched_upmigrate
echo 0 > /proc/sys/kernel/sched_downmigrate
echo 10 > /proc/sys/kernel/sched_spill_nr_run
echo 85 > /proc/sys/kernel/sched_spill_load
done
echo "@refresh_ui"
echo @toast=Large core priority load application completed
fi

if [ $position == 2 ]
then
echo 95 > /proc/sys/kernel/sched_upmigrate
echo 95 > /proc/sys/kernel/sched_downmigrate
echo 4 > /proc/sys/kernel/sched_spill_nr_run
echo 85 > /proc/sys/kernel/sched_spill_load
echo "@refresh_ui"
echo @toast=Small core active mode is applied
fi

@done
@current
echo position=0
@current
!view


!module